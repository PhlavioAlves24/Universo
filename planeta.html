<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Planeta 3D</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: black; }
        canvas { display: block; touch-action: none; }
        #planet-id {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 18px;
            color: white;
            font-family: Arial, sans-serif;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 5px;
        }
        #back-button {
            position: absolute;
            bottom: 20px;
            left: 20px;
            font-size: 16px;
            padding: 10px 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        #settings-button {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 16px;
            padding: 10px 15px;
            background-color: #555;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        #settings-menu {
            position: absolute;
            top: 60px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            font-family: Arial, sans-serif;
            padding: 10px;
            border-radius: 5px;
            display: none;
        }
        #settings-menu label { display: block; margin: 5px 0; }
        #settings-menu input[type="range"] { width: 100%; }
        #settings-menu button {
            display: block;
            width: 100%;
            margin: 5px 0;
            padding: 8px;
            background: #444;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            text-align: left;
        }
        #settings-menu button:hover { background: #666; }
    </style>
</head>
<body>

<div id="planet-id">Carregando...</div>
<button id="back-button" onclick="window.history.back()">Voltar</button>
<button id="settings-button">⚙️</button>
<div id="settings-menu">
    <label for="rotation-speed">Velocidade de Rotação:</label>
    <input type="range" id="rotation-speed" min="0" max="0.1" step="0.001" value="0.01">

    <label for="orbit-speed">Velocidade da Órbita:</label>
    <input type="range" id="orbit-speed" min="0" max="0.1" step="0.001" value="0.01">

    <label for="zoom-level">Zoom:</label>
    <input type="range" id="zoom-level" min="4" max="8" step="0.1" value="6">

    <label for="planet-size">Tamanho do Planeta:</label>
    <input type="range" id="planet-size" min="0.1" max="0.5" step="0.01" value="0.2">

    <button id="toggle-atmosphere">Remover Atmosfera</button>
    <button id="toggle-land">Remover Solo</button>
    <button onclick="toggleSettings()">Voltar</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.138.3/build/three.min.js"></script>

<script>
    function hashStringToNumber(str) {
        let hash = 0;
        for (let i = 0; i < str.length; i++) {
            hash = str.charCodeAt(i) + ((hash << 5) - hash);
        }
        return hash;
    }

    const params = new URLSearchParams(window.location.search);
    const planetId = params.get('id') || 'Desconhecido';
    document.getElementById('planet-id').textContent = `Planeta: ${planetId}`;

    // **Obtem a cor do Sol do localStorage (mesma cor da estrela do cubo)**
    const storedStarColor = localStorage.getItem(`starData`);
    let starColor = 0xFFFF00; // default amarelo
    if (storedStarColor) {
        const stars = JSON.parse(storedStarColor);
        const matchedStar = stars.find(s => s.id === planetId);
        if (matchedStar) {
            starColor = parseInt(matchedStar.color, 16);
        }
    }

    const palettes = [
        { name: "Earth-like", colorLand: new THREE.Color(0x3CB371), desertColor: new THREE.Color(0xF0E68C), mountainColor: new THREE.Color(0x778899), colorWater: new THREE.Color(0x1E90FF), snowColor: new THREE.Color(0xFFFAFA), atmosphereColor: new THREE.Color(0.6,0.8,1.0) },
        { name: "Mars-like", colorLand: new THREE.Color(0xA0522D), desertColor: new THREE.Color(0xCD853F), mountainColor: new THREE.Color(0x8B4513), colorWater: new THREE.Color(0x8B0000), snowColor: new THREE.Color(0xF08080), atmosphereColor: new THREE.Color(1.0,0.6,0.4) },
        { name: "Venus-like", colorLand: new THREE.Color(0xD2B48C), desertColor: new THREE.Color(0xE9D6AC), mountainColor: new THREE.Color(0xB8860B), colorWater: new THREE.Color(0xFFE4C4), snowColor: new THREE.Color(0xFFE4C4), atmosphereColor: new THREE.Color(1.0,0.8,0.6) },
        { name: "Jupiter-like", colorLand: new THREE.Color(0xE9C2A6), desertColor: new THREE.Color(0xDEB887), mountainColor: new THREE.Color(0xA0522D), colorWater: new THREE.Color(0xF5DEB3), snowColor: new THREE.Color(0xF5DEB3), atmosphereColor: new THREE.Color(0.8,0.6,0.4) },
        { name: "Neptune-like", colorLand: new THREE.Color(0x6495ED), desertColor: new THREE.Color(0x778899), mountainColor: new THREE.Color(0x708090), colorWater: new THREE.Color(0x1E90FF), snowColor: new THREE.Color(0xB0E2FF), atmosphereColor: new THREE.Color(0.4,0.6,1.0) },
        { name: "Exoplanet-1", colorLand: new THREE.Color(0x8B4513), desertColor: new THREE.Color(0xA52A2A), mountainColor: new THREE.Color(0x654321), colorWater: new THREE.Color(0x006400), snowColor: new THREE.Color(0xFFFFFF), atmosphereColor: new THREE.Color(0.5,0.3,0.1) },
        { name: "Exoplanet-2", colorLand: new THREE.Color(0x4682B4), desertColor: new THREE.Color(0x708090), mountainColor: new THREE.Color(0x2F4F4F), colorWater: new THREE.Color(0x000080), snowColor: new THREE.Color(0xF0F8FF), atmosphereColor: new THREE.Color(0.2,0.4,0.7) },
        { name: "Exoplanet-3", colorLand: new THREE.Color(0xDAA520), desertColor: new THREE.Color(0xB8860B), mountainColor: new THREE.Color(0x8B4513), colorWater: new THREE.Color(0x228B22), snowColor: new THREE.Color(0xFFDAB9), atmosphereColor: new THREE.Color(0.7,0.5,0.2) },
        { name: "Exoplanet-4", colorLand: new THREE.Color(0x483D8B), desertColor: new THREE.Color(0x6A5ACD), mountainColor: new THREE.Color(0x7B68EE), colorWater: new THREE.Color(0x0000CD), snowColor: new THREE.Color(0xE6E6FA), atmosphereColor: new THREE.Color(0.3,0.3,0.5) },
        { name: "Exoplanet-5", colorLand: new THREE.Color(0x8FBC8F), desertColor: new THREE.Color(0xBDB76B), mountainColor: new THREE.Color(0x556B2F), colorWater: new THREE.Color(0x2E8B57), snowColor: new THREE.Color(0xF5F5DC), atmosphereColor: new THREE.Color(0.4,0.6,0.4) }
    ];

    const paletteIndex = Math.abs(hashStringToNumber(planetId)) % palettes.length;
    const palette = palettes[paletteIndex];

    let scene, camera, renderer, planet, atmosphere, sun, planetShaderMaterial, solarSystemGroup;
    let isDragging = false, previousTouch = {x:0, y:0};
    let rotationSpeed = 0.01, orbitAngle = 0, orbitSpeed = 0.01, systemRotationX = 0, systemRotationY = 0;
    let atmosphereVisible = true, landVisible = true, planetSize = 0.2;
    const waterColor = palette.colorWater;

    function init() {
        scene = new THREE.Scene();
        camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1,1000);
        renderer = new THREE.WebGLRenderer({antialias:true});
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);
        scene.background = new THREE.Color(0x000000);

        solarSystemGroup = new THREE.Group();
        scene.add(solarSystemGroup);

        // **SOL com a cor do cubo**
        const sunGeometry = new THREE.SphereGeometry(0.5,32,32);
        const sunMaterial = new THREE.MeshBasicMaterial({color: starColor, emissive: starColor});
        sun = new THREE.Mesh(sunGeometry,sunMaterial);
        scene.add(sun);

        const planetGeometry = new THREE.SphereGeometry(planetSize,64,64);
        planetShaderMaterial = new THREE.ShaderMaterial({
            uniforms: {
                colorLand:{value: palette.colorLand},
                desertColor:{value: palette.desertColor},
                mountainColor:{value: palette.mountainColor},
                colorWater:{value: palette.colorWater},
                snowColor:{value: palette.snowColor},
                seed:{value: Math.abs(hashStringToNumber(planetId))%1000},
                lightDirection:{value: new THREE.Vector3(0.5,0.5,1)},
                roughness:{value:0.5}
            },
            vertexShader: `varying vec3 vNormal; varying vec3 vPosition; void main(){vNormal=normalize(normal); vPosition=position; gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.0);}`,
            fragmentShader: `varying vec3 vNormal; varying vec3 vPosition; uniform vec3 colorLand; uniform vec3 desertColor; uniform vec3 mountainColor; uniform vec3 colorWater; uniform vec3 snowColor; uniform float seed; uniform vec3 lightDirection; uniform float roughness; void main(){float height=0.5; vec3 terrain=colorLand; vec3 color=mix(colorWater, terrain, 0.5); float diff=max(dot(normalize(vNormal),normalize(lightDirection)),0.0); color*=(roughness+0.5*diff); gl_FragColor=vec4(color,1.0);}`
        });
        planet = new THREE.Mesh(planetGeometry,planetShaderMaterial);

        const atmosphereMaterial = new THREE.ShaderMaterial({
            vertexShader:`varying vec3 vNormal; void main(){vNormal=normalize(normal); gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.1);}`,
            fragmentShader:`varying vec3 vNormal; uniform vec3 atmosphereColor; void main(){float intensity=pow(1.0-dot(vNormal,vec3(0,0,1)),3.0); gl_FragColor=vec4(atmosphereColor,intensity*0.5);}`,
            uniforms:{atmosphereColor:{value:palette.atmosphereColor}},
            blending:THREE.AdditiveBlending,
            side:THREE.BackSide,
            transparent:true
        });
        atmosphere = new THREE.Mesh(planetGeometry, atmosphereMaterial);
        atmosphere.scale.set(1.2,1.2,1.2);
        planet.add(atmosphere);
        solarSystemGroup.add(planet);

        camera.position.z = 6;

        renderer.domElement.addEventListener('wheel', onMouseWheel,false);
        renderer.domElement.addEventListener('touchstart', onTouchStart);
        renderer.domElement.addEventListener('touchmove', onTouchMove);
        renderer.domElement.addEventListener('touchend', onTouchEnd);

        document.getElementById('settings-button').addEventListener('click', toggleSettings);
        document.getElementById('toggle-atmosphere').addEventListener('click', toggleAtmosphere);
        document.getElementById('toggle-land').addEventListener('click', toggleLand);
        document.getElementById('rotation-speed').addEventListener('input', updateRotationSpeed);
        document.getElementById('zoom-level').addEventListener('input', updateZoom);
        document.getElementById('orbit-speed').addEventListener('input', updateOrbitSpeed);
        document.getElementById('planet-size').addEventListener('input', updatePlanetSize);
    }

    function animate() {
        requestAnimationFrame(animate);
        orbitAngle+=orbitSpeed;
        planet.position.x=Math.cos(orbitAngle)*2;
        planet.position.z=Math.sin(orbitAngle)*2;
        planet.rotation.y+=rotationSpeed;
        solarSystemGroup.rotation.x=systemRotationX;
        solarSystemGroup.rotation.y=systemRotationY;
        renderer.render(scene,camera);
    }

    function onMouseWheel(e){camera.position.z+=e.deltaY*0.1; camera.position.z=Math.max(4,Math.min(camera.position.z,8));}
    function onTouchStart(e){if(e.touches.length===1){isDragging=true; previousTouch.x=e.touches[0].clientX; previousTouch.y=e.touches[0].clientY;}}
    function onTouchMove(e){if(!isDragging||e.touches.length!==1)return; const touch=e.touches[0]; const deltaX=touch.clientX-previousTouch.x; const deltaY=touch.clientY-previousTouch.y; systemRotationY+=deltaX*0.005; systemRotationX+=deltaY*0.005; previousTouch.x=touch.clientX; previousTouch.y=touch.clientY;}
    function onTouchEnd(){isDragging=false;}
    function toggleSettings(){const m=document.getElementById('settings-menu'); m.style.display=m.style.display==='block'?'none':'block';}
    function toggleAtmosphere(){atmosphereVisible=!atmosphereVisible; atmosphere.visible=atmosphereVisible; document.getElementById('toggle-atmosphere').textContent=atmosphereVisible?"Remover Atmosfera":"Adicionar Atmosfera";}
    function toggleLand(){landVisible=!landVisible; if(landVisible){planet.material=planetShaderMaterial; document.getElementById('toggle-land').textContent="Remover Solo";}else{const mat=new THREE.ShaderMaterial({uniforms:{colorLand:{value:new THREE.Color(0x000000)},colorWater:{value:waterColor},seed:{value:Math.abs(hashStringToNumber(planetId))%1000},lightDirection:{value:new THREE.Vector3(0.5,0.5,1)}},vertexShader:`varying vec3 vNormal; varying vec3 vPosition; void main(){vNormal=normalize(normal); vPosition=position; gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.0);}`,fragmentShader:`varying vec3 vNormal; varying vec3 vPosition; uniform vec3 colorLand; uniform vec3 colorWater; uniform float seed; uniform vec3 lightDirection; void main(){float height=0.0; vec3 color=mix(colorWater,colorLand,smoothstep(0.45,0.5,height)); float diff=max(dot(normalize(vNormal),normalize(lightDirection)),0.0); color*=(0.5+0.5*diff); gl_FragColor=vec4(color,1.0);}`}); planet.material=mat; document.getElementById('toggle-land').textContent="Adicionar Solo";}}
    function updateRotationSpeed(e){rotationSpeed=parseFloat(e.target.value);}
    function updateZoom(e){camera.position.z=parseFloat(e.target.value);}
    function updateOrbitSpeed(e){orbitSpeed=parseFloat(e.target.value);}
    function updatePlanetSize(e){planetSize=parseFloat(e.target.value); planet.geometry.dispose(); planet.geometry=new THREE.SphereGeometry(planetSize,64,64); atmosphere.geometry.dispose(); atmosphere.geometry=new THREE.SphereGeometry(planetSize,64,64); atmosphere.scale.set(1.2,1.2,1.2);}
    window.addEventListener('resize',()=>{renderer.setSize(window.innerWidth,window.innerHeight); camera.aspect=window.innerWidth/window.innerHeight; camera.updateProjectionMatrix();});

    init();
    animate();
</script>

</body>
</html>
